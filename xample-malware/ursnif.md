<table>
<tr>
<td><b>ID</b></td>
<td><b>X0022</b></td>
</tr>
<tr>
<td><b>Aliases</b></td>
<td><b>Dreambot, Gozi</b></td>
</tr>
<tr>
<td><b>Platforms</b></td>
<td><b>Windows</b></td>
</tr>
<tr>
<td><b>Year</b></td>
<td><b>2016</b></td>
</tr>
<tr>
<td><b>Associated ATT&CK Software</b></td>
<td><b><a href="https://attack.mitre.org/software/S0386/">Ursnif</a></b></td>
</tr>
</table>


# Ursnif

Ursnif is a variant of Gozi. It is a banking trojan that uses malware macros to evade sandbox detection.


## ATT&CK Techniques

|Name|Use|
|---|---|
|[Discovery::System Location Discovery::System Language Discovery (T1614.001)](https://attack.mitre.org/techniques/T1614/001)|Ursnif gets keyboard layouts. [[6]](#6)|

See ATT&CK: [Ursnif - Techniques Used](https://attack.mitre.org/software/S0386/).

## Enhanced ATT&CK Techniques

|Name|Use|
|---|---|
|[Persistance::Registry Run Keys / Startup Folder (F0012)](../persistence/registry-run-keys-startup-folder.md)|The malware adds registry entries to ensure automatic execution at system startup. [[4]](#4)|
|[Defense Evasion::Hijack Execution Flow (F0015)](../defense-evasion/hijack-execution-flow.md)|The malware hooks various DLL exported functions when the DLL component is loaded into their respective browser application to monitor network traffic. [[4]](#4)|
|[Discovery::System Information Discovery (E1082)](../discovery/system-information-discovery.md)|The malware uses Window's command prompt commands to gather system info, task list, installed drivers, and installed programs. [[4]](#4)|
|[Collection::Input Capture (E1056)](../collection/input-capture.md)|The malware injects HTML into a browser session to collect sensitive online banking information when the victim performs their online banking. [[5]](#5)|
|[Defense Evasion::Obfuscated Files or Information (E1027)](../anti-static-analysis/executable-code-obfuscation.md)|The malware creates an encrypted Registry key called TorClient to store its data. [[2]](#2)|
|[Impact::Exploit Kit (E1190)](../impact/exploit-kit.md)|Ursnif is sometimes delivered via exploit kit. [[7]](#7)|
|[Collection::Keylogging::Polling (F0002.002)](../collection/keylogging.md)|Ursnif logs keystrokes via polling. [[6]](#6)|


## MBC Behaviors

|Name|Use|
|---|---|
|[Anti-Behavioral Analysis::Sandbox Detection::Self Check (B0007.007)](../anti-behavioral-analysis/sandbox-detection.md)|Ursnif uses malware macros to evade sandbox detection - checking whether the filename contains only hexadecimal characters before the extension. [[1]](#1)|
|[Execution::Conditional Execution (B0025.004)](../execution/conditional-execution.md)|Macros check if there are at least 50 running processes with a graphical interface, check if a list of blacklisted processes are running, and checks if the application is running in Australia and is NOT affiliated with a select group of networks (Security Research, Hospitals, Universities, Veterans, etc.). [[1]](#1)|
|[Anti-Behavioral Analysis::Virtual Machine Detection::Check Processes (B0009.004)](../anti-behavioral-analysis/virtual-machine-detection.md)|The malware checks if there are virtual machine processes running (Vbox, vmware, etc). [[1]](#1)|
|[Command and Control::Domain Name Generation (B0031)](../command-and-control/domain-name-generation.md)|Previous interations of Ursnif have used a Domain Name Generation algorithm. [[2]](#2)|
|[Command and Control::C2 Communication::Authenticate (B0030.011)](../command-and-control/c2-communication.md)|Ursnif variant Dreambot authenticates and encrypts traffic to the C2 server using TOR. [[2]](#2)|
|[Anti-Behavioral Analysis::Debugger Detection::TLS Callbacks (B0001.028)](../anti-behavioral-analysis/debugger-detection.md)|The malware manipulates TLS Callbacks while injecting into a child process. [[3]](#3)|
|[Memory::Change Memory Protection (C0008)](../micro-behaviors/memory/change-memory-protection.md)|The malware changes the PE header of the child process to enable write access to that page and writes 18 bytes of buffer at offset 0x40 from the start of svchost.exe in the target child process. The region protection is changed back to "read only" to avoid suspicion. [[3]](#3)|
|[Execution::Remote Commands (B0011)](../execution/remote-commands.md)|The malware commands sent by a remote user can archive/upload files, capture screenshots, clear cookies, download and  execute other files, list running processes, reboot the affected system, steal certificates and cookies, update/download a configuration file, and upload a log file which contains stolen information. [[5]](#5)|
|[Discovery::Code Discovery::Enumerate PE Sections (B0046.001)](../discovery/code-discovery.md)|Ursnif enumerates PE sections. [[6]](#6)|


## Indicators of Compromise

SHA256 Hashes
- 6464cf93832a5188d102cce498b4f3be0525ea1b080fec9c4e12fae912984057
- 0b05fb5b97bfc3c82f46b8259a88ae656b1ad294e4c1324d8e8ffd59219005ac
- 9350609c8c806a9c1a667fd53926ea85745e1da239df7f3c2aad3e3527bd48d1

URLS, IPs, and Domains
- hxxp://62.138.9[.]11/30030u
- hxxp://62.138.9[.]11/vnc32.dll
- hxxp://62.138.9[.]11/vnc64.dll
- 62.138.9[.]9
- 62.75.195[.]103
- 62.75.195[.]117
- ca-tda[.]com
- au-tdc[.]com
- au-tda[.]com
- 109.236.87[.]82:443
- hxxp://deekayallday[.]com/data/office

## References

<a name="1">[1]</a> https://www.proofpoint.com/us/threat-insight/post/ursnif-banking-trojan-campaign-sandbox-evasion-techniques

<a name="2">[2]</a> https://www.proofpoint.com/us/threat-insight/post/ursnif-variant-dreambot-adds-tor-functionality

<a name="3">[3]</a> https://www.fireeye.com/blog/threat-research/2017/11/ursnif-variant-malicious-tls-callback-technique.html

<a name="4">[4]</a> https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/PE_URSNIF.A2?_ga=2.131425807.1462021705.1559742358-1202584019.1549394279

<a name="5">[5]</a> https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/BKDR_URSNIF.SM?_ga=2.129468940.1462021705.1559742358-1202584019.1549394279

<a name="6">[6]</a> capa v4.0, analyzed at MITRE on 10/12/2022

<a name="7">[7]</a> https://www.cyber.nj.gov/threat-profiles/trojan-variants/ursnif
